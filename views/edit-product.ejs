<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Edit Produk</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
  <style>
    body { font-family: 'Inter', sans-serif; }
  </style>
</head>
<body class="bg-gray-100 px-6 py-10">
  <div class="max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-2xl font-semibold mb-6 text-blue-900">‚úèÔ∏è Edit Produk</h2>

    <form action="/edit-product/<%= product.reference %>" method="POST" class="space-y-4" onsubmit="return validateForm()">
      <input type="hidden" name="reference" value="<%= product.reference %>" />

      <div>
        <label class="block text-sm font-medium text-gray-700">Nama Produk</label>
        <input name="product_name" type="text" required value="<%= product.product_name %>" class="mt-1 w-full border border-gray-300 rounded-md shadow-sm px-3 py-2"/>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">Brand</label>
        <input name="brand" type="text" required value="<%= product.brand %>" class="mt-1 w-full border border-gray-300 rounded-md shadow-sm px-3 py-2"/>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700">Harga</label>
          <input name="price" type="number" min="0" required value="<%= product.price %>" class="mt-1 w-full border border-gray-300 rounded-md shadow-sm px-3 py-2"/>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Diskon (%)</label>
          <input name="discount_percentage" type="number" step="0.01" min="0" max="100" value="<%= product.discount_percentage %>" class="mt-1 w-full border border-gray-300 rounded-md shadow-sm px-3 py-2"/>
        </div>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">Stok</label>
        <input name="stock" type="number" min="0" required value="<%= product.stock %>" class="mt-1 w-full border border-gray-300 rounded-md shadow-sm px-3 py-2"/>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">Kategori</label>
        <select name="category" class="mt-1 w-full border border-gray-300 rounded-md shadow-sm px-3 py-2" required>
          <option value="">Pilih Kategori</option>
          <% categories.forEach(cat => { %>
            <option value="<%= cat %>" <%= product.category === cat ? 'selected' : '' %>><%= cat %></option>
          <% }) %>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">URL Gambar (dipisah koma jika lebih dari 1)</label>
        <input name="images" type="text" value="<%= product.images ? product.images.join(', ') : '' %>" class="mt-1 w-full border border-gray-300 rounded-md shadow-sm px-3 py-2" placeholder="Contoh: https://image1.jpg, https://image2.jpg" oninput="previewImages(this.value)" />
      </div>

      <div id="image-preview" class="flex flex-wrap gap-4 mt-4">
        <% if (product.images && product.images.length > 0) { %>
          <% product.images.forEach(img => { %>
            <img src="<%= img %>" alt="Preview" class="w-24 h-24 object-cover rounded border border-gray-300">
          <% }) %>
        <% } %>
      </div>

      <div class="flex justify-between mt-6">
        <a href="/dashboard" class="text-gray-500 hover:underline">‚Üê Kembali</a>
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">üíæ Simpan Perubahan</button>
      </div>
    </form>
  </div>

  <script>
    function previewImages(value) {
      const preview = document.getElementById('image-preview');
      preview.innerHTML = '';
      const urls = value.split(',').map(s => s.trim()).filter(Boolean);
      urls.forEach(url => {
        const img = document.createElement('img');
        img.src = url;
        img.className = 'w-24 h-24 object-cover rounded border border-gray-300';
        preview.appendChild(img);
      });
    }

    function validateForm() {
      const price = document.querySelector('[name="price"]').value;
      if (price < 0) {
        alert('Harga tidak boleh negatif');
        return false;
      }
      return true;
    }
  </script>
</body>
</html>
